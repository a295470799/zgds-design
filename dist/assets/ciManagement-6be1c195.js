import{r as _,j as e,D as k,a as R,B as d,s as B,b,T as P,c as L,e as O,u as G,q as W,d as v,P as U}from"./index-736c7350.js";import{A as E}from"./AccountWrapper-03ffa386.js";import{d as K,g as Z,a as q,b as H}from"./account-7328c4f5.js";import{f as V,b as Q,a as J,c as Y}from"./format-122126ae.js";import{A as S,z as $,M,C as X}from"./CheckSquare-3b7c3da5.js";import{K as ee,C as ae,G as re,M as te}from"./index-d2f8e32e.js";import{u as oe}from"./index-e9b1d892.js";import{T as ne,a as F}from"./Tabs-ec2b7115.js";import{D as ie}from"./DialogContent-1a200351.js";import{T as de,S as le}from"./TextField-ddf87520.js";import{P as se}from"./Pagination-748abc1b.js";import{C as ce}from"./CircularProgress-0c5e9a3e.js";function z(f){const{children:n,value:u,index:l,...o}=f;return e.jsx("div",{role:"tabpanel",hidden:u!==l,...o,children:u===l&&e.jsx(d,{width:980,children:n})})}const me=f=>{const{open:n,onClose:u,detailData:l=[],partnersData:o=[],detailOptions:y,partnersOptions:D}=f,[C,j]=_.useState(0),I=(r,p)=>{j(p)};return e.jsxs(k,{open:n,maxWidth:"lg",children:[e.jsx(R,{onClose:u,children:e.jsx(d,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ne,{value:C,onChange:I,children:[e.jsx(F,{label:"CI Detail"}),e.jsx(F,{label:"Partners"})]})})}),e.jsxs(ie,{children:[e.jsx(z,{value:C,index:0,children:e.jsx(d,{width:980,height:370,className:"ag-theme-alpine",sx:r=>({".ag-header-cell-text, .ag-cell-value, .ag-group-value":{color:r.palette.text.third}}),children:e.jsx(S,{rowData:l,gridOptions:y,onFirstDataRendered:r=>{var h,g,x;const p=((g=(h=r.columnApi)==null?void 0:h.getColumns())==null?void 0:g.map(N=>N.getId()))??[];(x=r.columnApi)==null||x.autoSizeColumns(p,!1)}})})}),e.jsx(z,{value:C,index:1,children:e.jsx(d,{width:980,height:370,className:"ag-theme-alpine",sx:r=>({".ag-header-cell-text, .ag-cell-value, .ag-group-value":{color:r.palette.text.third}}),children:e.jsx(S,{rowData:o,gridOptions:D,onFirstDataRendered:r=>{var h,g,x;const p=((g=(h=r.columnApi)==null?void 0:h.getColumns())==null?void 0:g.map(N=>N.getId()))??[];(x=r.columnApi)==null||x.autoSizeColumns(p,!1)}})})})]})]})},ue=B(b)`
  height: 22px;
  font-size: 1.2rem;
  padding: 0 10px;
  min-width: auto;
  font-weight: 400;
`,pe=f=>{var T,A,w;const{rowData:n,onChange:u,filters:l}=f,o=a=>J(a.value),y=a=>Y(a.value,!0),D=async a=>{p({open:!0,gridDetailData:[],gridPartnersData:[]});const t=await Z(a);p({gridDetailData:t.items,gridPartnersData:t.partners})},C=[{field:"invoiceNumber",headerName:"CI NO.",width:200,checkboxSelection:!0,headerCheckboxSelection:!0},{headerName:"Action",cellRenderer:a=>e.jsx(d,{children:e.jsx(ue,{color:"primary",onClick:()=>D(a.data.invoiceNumber),children:"Detail"})})},{field:"orderNumber",headerName:"Order"},{field:"orderId",headerName:"Order ID"},{field:"oldOrderId",headerName:"Order ID (old)"},{field:"oldInvoiceNumber",headerName:"CI NO. (old)"},{field:"customContractId",headerName:"PO NO."},{field:"customerName",headerName:"Client name"},{field:"invoiceBusinessTypeValue",headerName:"Invoice type"},{field:"currencyCode",headerName:"Currency"},{field:"fromCountryCode",headerName:"From country"},{field:"fromProvinceCode",headerName:"From province"},{field:"destCountryCode",headerName:"To country"},{field:"destProvinceCode",headerName:"To province"},{field:"paymentConditionValue",headerName:"Price term"},{field:"tradeClauseCode",headerName:"Trade term"},{field:"orderTotalAmount",headerName:"Order total",valueFormatter:o},{field:"orderTaxAmount",headerName:"Tax",valueFormatter:o},{field:"orderTaxRadio",headerName:"Tax rate"},{field:"orderFreight",headerName:"Shipping",valueFormatter:o},{field:"invoiceDate",headerName:"Invoice Date",sortable:!0,unSortIcon:!0,valueFormatter:y}],j=[{field:"orderId",headerName:"Order ID"},{field:"invoiceNumberCode",headerName:"CI NO."},{field:"productMainCode",headerName:"SKU"},{field:"productNameEn",headerName:"Product"},{field:"skuNumber",headerName:"Qty"},{field:"customDisplayCode",headerName:"Customer's SKU"},{field:"excludingTaxPrices",headerName:"ex.Tax Total",valueFormatter:o},{field:"skuFreight",headerName:"Shipping",valueFormatter:o},{field:"skuTaxAmount",headerName:"Tax",valueFormatter:o},{field:"includingTaxPrices",headerName:"incl.Tax Total",valueFormatter:o},{field:"skuTaxRadio",headerName:"Tax rate"},{field:"sellingPrice",headerName:"Selling Price",valueFormatter:o},{field:"includeTaxPrice",headerName:"incl.Tax Unit",valueFormatter:o},{field:"excludeTaxPrice",headerName:"ex.Tax Unit",valueFormatter:o}],I=[{field:"partnerType",headerName:"Partner type"},{field:"partnerName",headerName:"Partner name"},{field:"contractName",headerName:"Contact name"},{field:"contractAddress1",headerName:"Add1"},{field:"contractAddress2",headerName:"Add2"},{field:"contractPhone",headerName:"Phone"},{field:"contractEmail",headerName:"Mail"},{field:"contractCountryCode",headerName:"Country"},{field:"contractStateyCode",headerName:"Province"},{field:"contractCityCode",headerName:"City"},{field:"contractPostalCode",headerName:"Postcode"}],[r,p]=oe({open:!1,params:{page:1,page_size:50},gridOptions:{defaultColDef:{initialWidth:160,resizable:!0},rowSelection:"multiple",ensureDomOrder:!0,enableCellTextSelection:!0,multiSortKey:"ctrl",onSortChanged:u,columnDefs:C},gridDetailOptions:{defaultColDef:{initialWidth:140,resizable:!0,filter:!0,sortable:!0,floatingFilter:!0},ensureDomOrder:!0,enableCellTextSelection:!0,columnDefs:j,rowData:[]},gridPartnersOptions:{defaultColDef:{initialWidth:140,resizable:!0},ensureDomOrder:!0,enableCellTextSelection:!0,columnDefs:I,rowData:[]}}),h=a=>{const t={...r.params,...a};Array.isArray(t.search_date)&&t.search_date.length>0&&(t.search_date=t.search_date.filter(i=>i).map(i=>V(i))),p({params:t}),u(t)},[g,x]=_.useState(!1),N=async()=>{var t,i;const a=(t=r.gridOptions.api)==null?void 0:t.getSelectedRows().map(s=>s.id);if(Array.isArray(a)&&a.length>0)try{x(!0);const s=await K(a);if(((i=s==null?void 0:s.data)==null?void 0:i.type)=="application/pdf"){const c=window.URL.createObjectURL(new Blob([s.data])),m=document.createElement("a");m.href=c,m.setAttribute("download",`${Math.round(new Date().valueOf()/1e3)}.pdf`),document.body.appendChild(m),m.click()}else Q(s.data).then(c=>{O((c==null?void 0:c.message)||"System busy, please retry",{variant:"error"})}).catch(c=>{console.error(c),O("System busy, please retry",{variant:"error"})})}finally{x(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{onSuccess:h,values:{ship_to:[],freeFaxNumber:[]},children:e.jsxs(d,{display:"flex",flexWrap:"wrap",alignItems:"flex-end",justifyContent:"space-between",padding:"0 20px",columnGap:"25px",sx:{"& .MuiFormHelperText-root":{display:"none"}},children:[e.jsxs(d,{display:"flex",flexWrap:"wrap",justifyContent:"space-between",flex:1,sx:{"> .MuiFormControl-root":{marginTop:"15px"}},children:[e.jsx(d,{width:"48%",marginTop:"15px",sx:{"& .mui__clear_icon":{"&::after":{content:'""',width:"20px",height:"20px",padding:"3px",background:"url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzcwNzA3MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE5IDYuNDFMMTcuNTkgNSAxMiAxMC41OSA2LjQxIDUgNSA2LjQxIDEwLjU5IDEyIDUgMTcuNTkgNi40MSAxOSAxMiAxMy40MSAxNy41OSAxOSAxOSAxNy41OSAxMy40MSAxMnoiPjwvcGF0aD4KPC9zdmc+)"},"&:hover::after":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}},children:e.jsx(ae,{name:"search_date",render:({field:{value:a,onChange:t,ref:i}})=>e.jsx($,{selected:a==null?void 0:a[0],onChange:t,startDate:a==null?void 0:a[0],endDate:a==null?void 0:a[1],selectsRange:!0,customInput:e.jsx(de,{label:"Invoice Date",value:a??"",inputRef:i,InputProps:{autoComplete:"off"},fullWidth:!0}),dateFormat:"yyyy/MM/dd",monthsShown:2,showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"select",dateFormatCalendar:"yyyy/MM/dd",isClearable:!0,clearButtonTitle:"Clear",clearButtonClassName:"mui__clear_icon"})})}),e.jsx(d,{width:"48%",marginTop:"15px",children:e.jsx(M,{name:"ship_to",options:((T=l==null?void 0:l.shipping_countrys)==null?void 0:T.map(a=>({id:a==null?void 0:a.area_code,label:a==null?void 0:a.area_short_name_en})))??[],label:"Ship to"})}),e.jsx(d,{width:"48%",marginTop:"15px",children:e.jsx(M,{name:"freeFaxNumber",options:(l==null?void 0:l.freeFaxNumbers)??[],label:"VAT NO"})}),e.jsx(re,{sx:{width:"48%"},name:"keyword",label:"Search for",type:"search",placeholder:"Input CI NO./Order/Order ID",InputProps:{autoComplete:"off"}})]}),e.jsx(b,{type:"submit",color:"success",size:"medium",children:"Search"})]})}),e.jsx(d,{display:"flex",columnGap:2,padding:"20px 20px 0",children:e.jsxs(b,{color:"success",size:"medium",onClick:N,children:[e.jsx("img",{src:X,style:{marginRight:"5px"}}),"Download CI PDF"]})}),e.jsx(d,{width:930,height:500,className:"ag-theme-alpine",marginTop:"20px",sx:a=>({".ag-header-cell-text, .ag-cell-value, .ag-group-value":{color:a.palette.text.third}}),children:e.jsx(S,{rowData:n==null?void 0:n.data,onGridReady:()=>u(r.params),gridOptions:r.gridOptions,onSortChanged:a=>{var i,s,c;var t=(c=(s=(i=r.gridOptions)==null?void 0:i.columnApi)==null?void 0:s.getColumnState())==null?void 0:c.filter(function(m){return m.sort!=null}).map(function(m){return{name:m.colId,order:m.sort}});h({sort:t??[]})},onFirstDataRendered:a=>{var i,s,c;const t=((s=(i=a.columnApi)==null?void 0:i.getColumns())==null?void 0:s.map(m=>m.getId()))??[];(c=a.columnApi)==null||c.autoSizeColumns(t,!1)}})}),e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",children:[e.jsxs(d,{display:"flex",alignItems:"center",columnGap:1,children:[e.jsx(P,{fontSize:"1.4rem",children:"View"}),e.jsx(le,{sx:{height:"30px",fontSize:"1.4rem"},value:(A=r.params)==null?void 0:A.page_size,onChange:a=>{h({page:1,page_size:a.target.value})},children:[50,100,200,300,500].map(a=>e.jsx(te,{value:a,children:a},a))}),e.jsx(P,{fontSize:"1.4rem",children:"Per Page"})]}),(n==null?void 0:n.last_page)&&e.jsx(se,{count:n==null?void 0:n.last_page,variant:"outlined",shape:"rounded",onChange:(a,t)=>{h({page:t})},defaultPage:Number((w=r.params)==null?void 0:w.page)??1})]}),e.jsx(me,{open:r.open,onClose:()=>p({open:!1}),detailOptions:r.gridDetailOptions,partnersOptions:r.gridPartnersOptions,detailData:r.gridDetailData,partnersData:r.gridPartnersData}),e.jsx(L,{sx:{color:"#fff",zIndex:a=>a.zIndex.drawer+1},open:g,children:e.jsx(ce,{color:"inherit"})})]})},he=pe;function Ae(){var o;const f=G();(o=W.parse(f.search))==null||o.type;const{data:n,runAsync:u}=v(q,{manual:!0}),{data:l}=v(H,{debounceWait:300});return e.jsx(E,{code:"ci",children:e.jsx(U,{children:e.jsx(he,{rowData:n,onChange:u,filters:l})})})}export{Ae as default};

import{s as I,b as g,y as B,r as A,j as e,B as a,T as x,c as V,e as _,g as Z,D as Q,a as X,u as Y,q as v,d as R,P as D}from"./index-736c7350.js";import{A as J}from"./AccountWrapper-03ffa386.js";import{b as ee,f as re,a as P,c as te}from"./format-122126ae.js";import{W as se}from"./WarningCircle-2a553d32.js";import{z as ne,M as W,C as F,A as ae}from"./CheckSquare-3b7c3da5.js";import{K as oe,C as ie,G as de,M as le}from"./index-d2f8e32e.js";import{u as ce}from"./index-e9b1d892.js";import{a as pe,c as he,b as xe,d as me}from"./order-3084bc16.js";import{j as ue,k as ge}from"./account-7328c4f5.js";import{T as E,S as fe}from"./TextField-ddf87520.js";import{P as ye}from"./Pagination-748abc1b.js";import{C as je}from"./CircularProgress-0c5e9a3e.js";import{U as Ce,D as we}from"./DownloadSimple-78a5cf34.js";import{D as Se}from"./DialogContent-1a200351.js";const be="/assets/KeyReturn-8024311b.svg",Oe="/assets/ListChecks-fa93a361.svg",_e="/assets/XSquare-b57d0a11.svg",L=I(g)`
  height: 22px;
  font-size: 1.2rem;
  padding: 0 10px;
  min-width: auto;
  font-weight: 400;
`,Ae=f=>{var N,z,T;const{type:p,rowData:c,shippingCountry:m,onChange:s,defaultParams:t}=f,u=B(),j=r=>P(r.value),y=r=>te(r.value,!0),d=r=>{u(`/account/orderDetail?type=edit&id=${r}`,{state:h.params})},b=r=>{u(`/account/orderDetail?type=show&id=${r}`,{state:h.params})},[U,C]=A.useState(!1),$=async()=>{var n,o;const r=(n=h.gridOptions.api)==null?void 0:n.getSelectedRows().map(i=>i.id);if(Array.isArray(r)&&r.length>0)try{C(!0);const i=await ue(r);if(((o=i==null?void 0:i.data)==null?void 0:o.type)=="application/pdf"){const l=window.URL.createObjectURL(new Blob([i.data])),S=document.createElement("a");S.href=l,S.setAttribute("download",`${Math.round(new Date().valueOf()/1e3)}.pdf`),document.body.appendChild(S),S.click()}else ee(i.data).then(l=>{_((l==null?void 0:l.message)||"System busy, please retry",{variant:"error"})}).catch(l=>{console.error(l),_("System busy, please retry",{variant:"error"})})}finally{C(!1)}},O=[{field:"number",headerName:"Order"},{headerName:"Action",cellRenderer:r=>e.jsxs(a,{children:[e.jsx(L,{color:"success",sx:{marginRight:1},onClick:()=>d(r.data.id),disabled:r.data.status!="0",children:"Edit"}),e.jsx(L,{color:"primary",onClick:()=>b(r.data.id),children:"Detail"})]})},{field:"eya_number",headerName:"Order ID"},{field:"customContractId",headerName:"PO NO."},{field:"status_str",headerName:"Status"},{field:"order_type",headerName:"Order Type"},{field:"invoiceNumber",headerName:"Invoice NO."},{field:"shipping_country",headerName:"Ship to"},{field:"snaps_count",headerName:"Item"},{field:"total_price",headerName:"Total Amount",valueFormatter:j},{field:"created_at",headerName:"Order Date",sortable:!0,unSortIcon:!0,valueFormatter:y},{field:"updated_at",headerName:"Update Date",sortable:!0,unSortIcon:!0,valueFormatter:y}],[h,q]=ce({params:t,gridOptions:{defaultColDef:{initialWidth:160,resizable:!0},rowSelection:"multiple",ensureDomOrder:!0,enableCellTextSelection:!0,multiSortKey:"ctrl",onSortChanged:s,columnDefs:O}});A.useEffect(()=>{var n;const r=p=="pending"||p=="pdf";O[0].checkboxSelection=r,O[0].headerCheckboxSelection=r,(n=h.gridOptions.api)==null||n.setColumnDefs(O)},[p]);const w=r=>{const n={...h.params,...r};Array.isArray(n.search_date)&&n.search_date.length>0&&(n.search_date=n.search_date.filter(o=>o).map(o=>re(o))),q({params:n}),s(n)},H=async()=>{var n,o,i;const r=(i=(o=(n=h.gridOptions)==null?void 0:n.api)==null?void 0:o.getSelectedRows())==null?void 0:i.map(l=>l.id);if(Array.isArray(r)&&r.length>0){try{C(!0),await pe(r)}finally{C(!1)}_("Success!"),w(h.params)}},K=async()=>{var n,o,i;const r=(i=(o=(n=h.gridOptions)==null?void 0:n.api)==null?void 0:o.getSelectedRows())==null?void 0:i.map(l=>l.id);if(Array.isArray(r)&&r.length>0){try{C(!0),await he(r)}finally{C(!1)}_("Success!"),w(h.params)}};return e.jsxs(e.Fragment,{children:[e.jsx(oe,{onSuccess:w,values:{order_type:t==null?void 0:t.order_type,search_date:(N=t==null?void 0:t.search_date)==null?void 0:N.map(r=>new Date(r)),ship_to:t==null?void 0:t.ship_to,keyword:t==null?void 0:t.keyword},children:e.jsxs(a,{display:"flex",flexWrap:"wrap",alignItems:"flex-end",justifyContent:"space-between",padding:"0 20px",columnGap:"25px",sx:{"& .MuiFormHelperText-root":{display:"none"}},children:[e.jsxs(a,{display:"flex",flexWrap:"wrap",justifyContent:"space-between",flex:1,sx:{"> .MuiFormControl-root":{marginTop:"15px"}},children:[e.jsx(a,{width:"48%",marginTop:"15px",sx:{"& .mui__clear_icon":{"&::after":{content:'""',width:"20px",height:"20px",padding:"3px",background:"url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzcwNzA3MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE5IDYuNDFMMTcuNTkgNSAxMiAxMC41OSA2LjQxIDUgNSA2LjQxIDEwLjU5IDEyIDUgMTcuNTkgNi40MSAxOSAxMiAxMy40MSAxNy41OSAxOSAxOSAxNy41OSAxMy40MSAxMnoiPjwvcGF0aD4KPC9zdmc+)"},"&:hover::after":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}},children:e.jsx(ie,{name:"search_date",render:({field:{value:r,onChange:n,ref:o}})=>e.jsx(ne,{value:r??[],selected:r==null?void 0:r[0],onChange:n,startDate:r==null?void 0:r[0],endDate:r==null?void 0:r[1],selectsRange:!0,customInput:e.jsx(E,{label:"Order Date",inputRef:o,InputProps:{autoComplete:"off"},fullWidth:!0}),dateFormat:"yyyy/MM/dd",monthsShown:2,showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"select",dateFormatCalendar:"yyyy/MM/dd",isClearable:!0,clearButtonTitle:"Clear",clearButtonClassName:"mui__clear_icon"})})}),e.jsx(a,{width:"48%",marginTop:"15px",children:e.jsx(W,{name:"order_type",options:["Dropship","Batch order"],label:"Order Type"})}),e.jsx(a,{width:"48%",marginTop:"15px",children:e.jsx(W,{name:"ship_to",options:(m==null?void 0:m.map(r=>({id:r==null?void 0:r.area_code,label:r==null?void 0:r.area_short_name_en})))??[],label:"Ship to"})}),e.jsx(de,{sx:{width:"48%"},name:"keyword",label:"Search for",type:"search",placeholder:"Order/Order ID/PO NO./SKU"})]}),e.jsx(g,{type:"submit",color:"success",size:"medium",children:"Search"})]})}),p=="pending"&&e.jsxs(a,{display:"flex",columnGap:2,padding:"20px 20px 0",children:[e.jsxs(g,{color:"success",size:"medium",onClick:H,children:["Confirm selected",e.jsx("img",{src:F,style:{marginLeft:"5px"}})]}),e.jsxs(g,{color:"secondary",size:"medium",onClick:K,children:["Cancel selected",e.jsx("img",{src:_e,style:{marginLeft:"5px"}})]})]}),p=="pdf"&&e.jsx(a,{display:"flex",columnGap:2,padding:"20px 20px 0",children:e.jsxs(g,{color:"success",size:"medium",onClick:$,children:[e.jsx("img",{src:F,style:{marginRight:"5px"}}),"Download PI PDF"]})}),e.jsx(a,{width:930,height:500,className:"ag-theme-alpine",marginTop:"20px",sx:r=>({".ag-header-cell-text, .ag-cell-value, .ag-group-value":{color:r.palette.text.third}}),children:e.jsx(ae,{rowData:c==null?void 0:c.data,gridOptions:h.gridOptions,onSortChanged:r=>{var n=r.columnApi.getColumnState().filter(function(o){return o.sort!=null}).map(function(o){return{name:o.colId,order:o.sort}});w({sort:n??[]})},onFirstDataRendered:r=>{var o,i,l;const n=((i=(o=r.columnApi)==null?void 0:o.getColumns())==null?void 0:i.map(S=>S.getId()))??[];(l=r.columnApi)==null||l.autoSizeColumns(n,!1)}})}),e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",children:[e.jsxs(a,{display:"flex",alignItems:"center",columnGap:1,children:[e.jsx(x,{fontSize:"1.4rem",children:"View"}),e.jsx(fe,{sx:{height:"30px",fontSize:"1.4rem"},value:(z=h.params)==null?void 0:z.page_size,onChange:r=>{w({page:1,page_size:r.target.value})},children:[50,100,200,300,500].map(r=>e.jsx(le,{value:r,children:r},r))}),e.jsx(x,{fontSize:"1.4rem",children:"Per Page"})]}),(c==null?void 0:c.last_page)&&e.jsx(ye,{count:c==null?void 0:c.last_page,variant:"outlined",shape:"rounded",onChange:(r,n)=>{w({page:n})},defaultPage:Number((T=h.params)==null?void 0:T.page)??1})]}),e.jsx(V,{sx:{color:"#fff",zIndex:r=>r.zIndex.drawer+1},open:U,children:e.jsx(je,{color:"inherit"})})]})},Ie=Ae,De="/assets/Warning-0ebbcb9a.svg",Me=f=>{const{open:p=!1,onClose:c}=f,{msg:m}=Z(),s=async t=>{const u=t.target.files&&t.target.files[0];if(u){var j=new FormData;j.set("file",u);try{await xe(j),m({message:"Order placed, please go to My Orders to confirm!",width:500,onConfirm(){window.location.reload()}})}catch(y){if(y.code==4001){const d=`
            <li>Order creation partially successful.</li>
            <li>The following information is incorrect and the creation failed:</li>
            ${y.message}
          `;m({message:e.jsxs(a,{children:[e.jsx(a,{children:e.jsx("img",{src:De})}),e.jsx(a,{component:"ul",dangerouslySetInnerHTML:{__html:d},sx:{lineHeight:"24px",textAlign:"left","& li.item":{textDecoration:"underline"}}})]}),width:400})}else m({message:"Order format incorrect, please refer to the template and upload again."})}finally{t.target.value=""}}};return e.jsxs(Q,{open:p,maxWidth:"xs",children:[e.jsx(X,{onClose:c,titleSx:{padding:"9px 24px",textAlign:"center",background:t=>t.palette.primary.main,color:t=>t.palette.common.white,fontWeight:700},closeSx:{top:5,color:t=>t.palette.common.white},children:"Volume order"}),e.jsxs(Se,{sx:{margin:"36px 0 10px"},children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",width:260,children:[e.jsxs(g,{color:"success",sx:{fontSize:"1.2rem"},children:[e.jsxs(x,{component:"label",marginRight:"5px",htmlFor:"upload_order",display:"flex",columnGap:"5px",sx:{cursor:"pointer"},children:["Upload order",e.jsx("img",{src:Ce})]}),e.jsx(E,{type:"file",id:"upload_order",onChange:s,inputProps:{accept:".xls,.xlsx"},sx:{display:"none"}})]}),e.jsxs(g,{href:"/file/Template of Daily Dropshipment Order List.xlsx",children:[e.jsx(x,{marginRight:"5px",children:"Template"}),e.jsx("img",{src:we})]})]}),e.jsx(x,{fontSize:"1.2rem",fontWeight:500,mt:1,color:"secondary",children:"Only drop-order supported"})]})]})},ke=Me,M=I("p")`
  color: rgba(255, 255, 255, 0.5);
  font-size: 1.2rem;
  font-weight: 500;
`,k=I("p")`
  font-size: 1.6rem;
  font-weight: 700;
`,G=I(g)`
  position: relative;
  &.active {
    background: #f8f9fa;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border-radius: 5px;
    font-weight: 700;
    padding: 6px 10px;
  }
  ${f=>f.badge=="Pending"?`&::after {
          content: "";
          position: absolute;
          top: 0;
          right: 0;
          width: 12px;
          height: 12px;
          background: url(${se}) no-repeat center;
        }`:""}
`;function qe(){const f=Y(),p=B(),[c,m]=A.useState(!1),s=v.parse(f.search,{arrayFormat:"comma"});s!=null&&s.search_date&&typeof(s==null?void 0:s.search_date)=="string"&&(s.search_date=new Array(s.search_date)),s!=null&&s.order_type&&typeof(s==null?void 0:s.order_type)=="string"&&(s.order_type=new Array(s.order_type)),s!=null&&s.ship_to&&typeof(s==null?void 0:s.ship_to)=="string"&&(s.ship_to=new Array(s.ship_to));const t=Object.assign({page:1,page_size:50,search_date:[],order_type:[],ship_to:[]},s),{data:u,runAsync:j}=R(me,{defaultParams:[t],debounceWait:300,manual:!0}),{data:y}=R(ge,{debounceWait:300});return A.useEffect(()=>{j(t)},[f]),e.jsxs(J,{code:"orders",title:"My Orders",children:[e.jsx(D,{sx:d=>({background:d.palette.primary.light,color:d.palette.common.white}),children:e.jsxs(a,{display:"flex",justifyContent:"space-evenly",alignItems:"center",height:"60px",children:[e.jsxs(a,{textAlign:"center",children:[e.jsx(M,{children:"Orders"}),e.jsx(k,{children:"12"})]}),e.jsxs(a,{textAlign:"center",children:[e.jsx(M,{children:"Ordered items"}),e.jsx(k,{children:"471"})]}),e.jsxs(a,{textAlign:"center",children:[e.jsx(M,{children:"Total amount"}),e.jsx(k,{children:P(12723.39)})]})]})}),e.jsxs(D,{sx:{width:"80%",margin:"20px auto",height:"70px",display:"flex",justifyContent:"space-evenly",alignItems:"center"},children:[e.jsxs(x,{color:"primary",fontSize:"1.2rem",fontWeight:500,children:["You can also ",e.jsx("b",{children:"PLACE ORDER"})," by"]}),e.jsxs(g,{color:"success",sx:{width:"180px"},onClick:()=>p("/account/quickOrder"),children:[e.jsx(x,{fontSize:"1.2rem",fontWeight:700,marginRight:1,children:"Quick Order"}),e.jsx("img",{src:be})]}),e.jsxs(g,{color:"success",sx:{width:"180px"},onClick:()=>m(!0),children:[e.jsx(x,{fontSize:"1.2rem",fontWeight:700,marginRight:1,children:"Volume Order"}),e.jsx("img",{src:Oe})]})]}),e.jsxs(D,{children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 20px",children:[e.jsx(a,{display:"flex",columnGap:"10px",children:["","Pending","Confirmed","Processing","Packed","Completed","Cancelled"].map(d=>{const b=d.toLowerCase();return e.jsx(G,{variant:"text",badge:d,sx:{fontSize:"1.2rem",fontWeight:500},onClick:()=>{p(`/account/orders${d?`?type=${b}`:""}`)},className:((t==null?void 0:t.type)??"")==b?"active":"",children:d||"All orders"},d)})}),e.jsxs(a,{display:"flex",columnGap:"3px",fontSize:"1.2rem",children:[e.jsx(x,{color:"primary",fontWeight:700,children:(u==null?void 0:u.total)??0}),e.jsx(x,{fontWeight:500,color:"text.secondary",children:"results"})]})]}),e.jsx(a,{padding:"10px 20px",children:e.jsx(G,{variant:"text",onClick:()=>p("/account/orders?type=pdf"),className:(t==null?void 0:t.type)=="pdf"?"active":"",children:e.jsx(x,{color:"secondary",fontSize:"1.2rem",fontWeight:500,padding:"6px",sx:{textDecoration:"underline"},children:"PI PDF download"})})}),e.jsx(Ie,{type:t==null?void 0:t.type,shippingCountry:y,rowData:u,onChange:d=>{p(v.stringifyUrl({url:"/account/orders",query:d},{arrayFormat:"comma"}))},defaultParams:t}),e.jsx(ke,{open:c,onClose:()=>m(!1)})]})]})}export{qe as default};

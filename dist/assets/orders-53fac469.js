import{s as O,b as m,x as W,r as I,j as e,B as a,T as x,e as S,f as $,D as q,a as H,u as K,q as z,c as V,P as A}from"./index-7fc42087.js";import{A as Z}from"./AccountWrapper-5da3dd84.js";import{b as Q,f as X,a as L,c as Y}from"./format-97287686.js";import{W as J}from"./WarningCircle-2a553d32.js";import{z as ee,M as T,C as R,A as te}from"./CheckSquare-r-40e57cf3.js";import{K as re,C as se,G as ne,M as ae}from"./index-74fd18b7.js";import{u as oe}from"./index-8757bede.js";import{a as ie,c as de,b as le,d as ce}from"./order-a571d443.js";import{i as pe}from"./account-46570069.js";import{T as G,S as he}from"./TextField-916ee773.js";import{P as xe}from"./Pagination-fa08d295.js";import{U as me,D as ge}from"./DownloadSimple-r-f41c298e.js";import{D as ue}from"./DialogContent-5deca1de.js";const fe="/assets/KeyReturn-8024311b.svg",ye="/assets/ListChecks-fa93a361.svg",je="/assets/XSquare-r-b57d0a11.svg",v=O(m)`
  height: 22px;
  font-size: 1.2rem;
  padding: 0 10px;
  min-width: auto;
  font-weight: 400;
`,be=f=>{var M,N,k;const{type:p,rowData:c,onChange:g,defaultParams:r}=f,n=W(),u=t=>L(t.value),y=t=>Y(t.value,!0),d=t=>{n(`/account/orderDetail?type=edit&id=${t}`,{state:h.params})},j=t=>{n(`/account/orderDetail?type=show&id=${t}`,{state:h.params})},B=async()=>{var s,o;const t=(s=h.gridOptions.api)==null?void 0:s.getSelectedRows().map(i=>i.id);if(Array.isArray(t)&&t.length>0){const i=await pe(t);if(((o=i==null?void 0:i.data)==null?void 0:o.type)=="application/pdf"){const l=window.URL.createObjectURL(new Blob([i.data])),C=document.createElement("a");C.href=l,C.setAttribute("download",`${Math.round(new Date().valueOf()/1e3)}.pdf`),document.body.appendChild(C),C.click()}else Q(i.data).then(l=>{S((l==null?void 0:l.message)||"System busy, please retry",{variant:"error"})}).catch(l=>{console.error(l),S("System busy, please retry",{variant:"error"})})}},w=[{field:"number",headerName:"Order"},{headerName:"Action",cellRenderer:t=>e.jsxs(a,{children:[e.jsx(v,{color:"success",sx:{marginRight:1},onClick:()=>d(t.data.id),disabled:t.data.status!="0",children:"Edit"}),e.jsx(v,{color:"primary",onClick:()=>j(t.data.id),children:"Detail"})]})},{field:"eya_number",headerName:"Order ID"},{field:"customContractId",headerName:"PO NO."},{field:"status_str",headerName:"Status"},{field:"order_type",headerName:"Order Type"},{field:"invoiceNumber",headerName:"Invoice NO."},{field:"shipping_country",headerName:"Ship to"},{field:"snaps_count",headerName:"Item"},{field:"total_price",headerName:"Total Amount",valueFormatter:u},{field:"created_at",headerName:"Order Date",sortable:!0,unSortIcon:!0,valueFormatter:y},{field:"updated_at",headerName:"Update Date",sortable:!0,unSortIcon:!0,valueFormatter:y}],[h,E]=oe({params:r,gridOptions:{defaultColDef:{initialWidth:160,resizable:!0},rowSelection:"multiple",ensureDomOrder:!0,enableCellTextSelection:!0,multiSortKey:"ctrl",onSortChanged:g,columnDefs:w}});I.useEffect(()=>{var s;const t=p=="pending"||p=="pdf";w[0].checkboxSelection=t,w[0].headerCheckboxSelection=t,(s=h.gridOptions.api)==null||s.setColumnDefs(w)},[p]);const b=t=>{const s={...h.params,...t};Array.isArray(s.search_date)&&s.search_date.length>0&&(s.search_date=s.search_date.filter(o=>o).map(o=>X(o))),E({params:s}),g(s)},P=async()=>{var s,o,i;const t=(i=(o=(s=h.gridOptions)==null?void 0:s.api)==null?void 0:o.getSelectedRows())==null?void 0:i.map(l=>l.id);Array.isArray(t)&&t.length>0&&(await ie(t),S("Success!"),b(h.params))},U=async()=>{var s,o,i;const t=(i=(o=(s=h.gridOptions)==null?void 0:s.api)==null?void 0:o.getSelectedRows())==null?void 0:i.map(l=>l.id);Array.isArray(t)&&t.length>0&&(await de(t),S("Success!"),b(h.params))};return e.jsxs(e.Fragment,{children:[e.jsx(re,{onSuccess:b,values:{order_type:r==null?void 0:r.order_type,search_date:(M=r==null?void 0:r.search_date)==null?void 0:M.map(t=>new Date(t)),ship_to:r==null?void 0:r.ship_to,keyword:r==null?void 0:r.keyword},children:e.jsxs(a,{display:"flex",flexWrap:"wrap",alignItems:"flex-end",justifyContent:"space-between",padding:"0 20px",columnGap:"25px",sx:{"& .MuiFormHelperText-root":{display:"none"}},children:[e.jsxs(a,{display:"flex",flexWrap:"wrap",justifyContent:"space-between",flex:1,sx:{"> .MuiFormControl-root":{marginTop:"15px"}},children:[e.jsx(a,{width:"48%",marginTop:"15px",sx:{"& .mui__clear_icon":{"&::after":{content:'""',width:"20px",height:"20px",padding:"3px",background:"url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzcwNzA3MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE5IDYuNDFMMTcuNTkgNSAxMiAxMC41OSA2LjQxIDUgNSA2LjQxIDEwLjU5IDEyIDUgMTcuNTkgNi40MSAxOSAxMiAxMy40MSAxNy41OSAxOSAxOSAxNy41OSAxMy40MSAxMnoiPjwvcGF0aD4KPC9zdmc+)"},"&:hover::after":{backgroundColor:"rgba(0, 0, 0, 0.04)"}}},children:e.jsx(se,{name:"search_date",render:({field:{value:t,onChange:s,ref:o}})=>e.jsx(ee,{value:t??[],selected:t==null?void 0:t[0],onChange:s,startDate:t==null?void 0:t[0],endDate:t==null?void 0:t[1],selectsRange:!0,customInput:e.jsx(G,{label:"Order Date",inputRef:o,InputProps:{autoComplete:"off"},fullWidth:!0}),dateFormat:"yyyy/MM/dd",monthsShown:2,showMonthDropdown:!0,showYearDropdown:!0,dropdownMode:"select",dateFormatCalendar:"yyyy/MM/dd",isClearable:!0,clearButtonTitle:"Clear",clearButtonClassName:"mui__clear_icon"})})}),e.jsx(a,{width:"48%",marginTop:"15px",children:e.jsx(T,{name:"order_type",options:[{id:"Dropship",label:"Dropship"},{id:"Batch order",label:"Batch order"}],label:"Order Type"})}),e.jsx(a,{width:"48%",marginTop:"15px",children:e.jsx(T,{name:"ship_to",options:[{id:"DE",label:"DE"},{id:"FR",label:"FR"},{id:"FI",label:"FI"},{id:"GR",label:"GR"}],label:"Ship to"})}),e.jsx(ne,{sx:{width:"48%"},name:"keyword",label:"Search for",type:"search",placeholder:"Order/Order ID/PO NO./SKU"})]}),e.jsx(m,{type:"submit",color:"success",size:"medium",children:"Search"})]})}),p=="pending"&&e.jsxs(a,{display:"flex",columnGap:2,padding:"20px 20px 0",children:[e.jsxs(m,{color:"success",size:"medium",onClick:P,children:["Confirm selected",e.jsx("img",{src:R,style:{marginLeft:"5px"}})]}),e.jsxs(m,{color:"secondary",size:"medium",onClick:U,children:["Cancel selected",e.jsx("img",{src:je,style:{marginLeft:"5px"}})]})]}),p=="pdf"&&e.jsx(a,{display:"flex",columnGap:2,padding:"20px 20px 0",children:e.jsxs(m,{color:"success",size:"medium",onClick:B,children:[e.jsx("img",{src:R,style:{marginRight:"5px"}}),"Download PI PDF"]})}),e.jsx(a,{width:930,height:500,className:"ag-theme-alpine",marginTop:"20px",sx:t=>({".ag-header-cell-text, .ag-cell-value, .ag-group-value":{color:t.palette.text.third}}),children:e.jsx(te,{rowData:c==null?void 0:c.data,gridOptions:h.gridOptions,onSortChanged:t=>{var s=t.columnApi.getColumnState().filter(function(o){return o.sort!=null}).map(function(o){return{name:o.colId,order:o.sort}});b({sort:s??[]})},onFirstDataRendered:t=>{var o,i,l;const s=((i=(o=t.columnApi)==null?void 0:o.getColumns())==null?void 0:i.map(C=>C.getId()))??[];(l=t.columnApi)==null||l.autoSizeColumns(s,!1)}})}),e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",children:[e.jsxs(a,{display:"flex",alignItems:"center",columnGap:1,children:[e.jsx(x,{fontSize:"1.4rem",children:"View"}),e.jsx(he,{sx:{height:"30px",fontSize:"1.4rem"},value:(N=h.params)==null?void 0:N.page_size,onChange:t=>{b({page:1,page_size:t.target.value})},children:[50,100,200,300,500].map(t=>e.jsx(ae,{value:t,children:t},t))}),e.jsx(x,{fontSize:"1.4rem",children:"Per Page"})]}),(c==null?void 0:c.last_page)&&e.jsx(xe,{count:c==null?void 0:c.last_page,variant:"outlined",shape:"rounded",onChange:(t,s)=>{b({page:s})},defaultPage:Number((k=h.params)==null?void 0:k.page)??1})]})]})},Ce=be,we="/assets/Warning-f-0ebbcb9a.svg",Se=f=>{const{open:p=!1,onClose:c}=f,{msg:g}=$(),r=async n=>{const u=n.target.files&&n.target.files[0];if(u){var y=new FormData;y.set("file",u);try{await le(y),g({message:"Order placed, please go to My Orders to confirm!",width:500,onConfirm(){window.location.reload()}})}catch(d){if(d.code==4001){const j=`
            <li>Order creation partially successful.</li>
            <li>The following information is incorrect and the creation failed:</li>
            ${d.message}
          `;g({message:e.jsxs(a,{children:[e.jsx(a,{children:e.jsx("img",{src:we})}),e.jsx(a,{component:"ul",dangerouslySetInnerHTML:{__html:j},sx:{lineHeight:"24px",textAlign:"left","& li.item":{textDecoration:"underline"}}})]}),width:400})}else g({message:"Order format incorrect, please refer to the template and upload again."})}finally{n.target.value=""}}};return e.jsxs(q,{open:p,maxWidth:"xs",children:[e.jsx(H,{onClose:c,titleSx:{padding:"9px 24px",textAlign:"center",background:n=>n.palette.primary.main,color:n=>n.palette.common.white,fontWeight:700},closeSx:{top:5,color:n=>n.palette.common.white},children:"Volume order"}),e.jsxs(ue,{sx:{margin:"36px 0 10px"},children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",width:260,children:[e.jsxs(m,{color:"success",sx:{fontSize:"1.2rem"},children:[e.jsxs(x,{component:"label",marginRight:"5px",htmlFor:"upload_order",display:"flex",columnGap:"5px",sx:{cursor:"pointer"},children:["Upload order",e.jsx("img",{src:me})]}),e.jsx(G,{type:"file",id:"upload_order",onChange:r,inputProps:{accept:".xls,.xlsx"},sx:{display:"none"}})]}),e.jsxs(m,{href:"/file/Template of Daily Dropshipment Order List.xlsx",children:[e.jsx(x,{marginRight:"5px",children:"Template"}),e.jsx("img",{src:ge})]})]}),e.jsx(x,{fontSize:"1.2rem",fontWeight:500,mt:1,color:"secondary",children:"Only drop-order supported"})]})]})},Oe=Se,D=O("p")`
  color: rgba(255, 255, 255, 0.5);
  font-size: 1.2rem;
  font-weight: 500;
`,_=O("p")`
  font-size: 1.6rem;
  font-weight: 700;
`,F=O(m)`
  position: relative;
  &.active {
    background: #f8f9fa;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border-radius: 5px;
    font-weight: 700;
    padding: 6px 10px;
  }
  ${f=>f.badge=="Pending"?`&::after {
          content: "";
          position: absolute;
          top: 0;
          right: 0;
          width: 12px;
          height: 12px;
          background: url(${J}) no-repeat center;
        }`:""}
`;function Le(){const f=K(),p=W(),[c,g]=I.useState(!1),r=z.parse(f.search,{arrayFormat:"comma"});r!=null&&r.search_date&&typeof(r==null?void 0:r.search_date)=="string"&&(r.search_date=new Array(r.search_date)),r!=null&&r.order_type&&typeof(r==null?void 0:r.order_type)=="string"&&(r.order_type=new Array(r.order_type)),r!=null&&r.ship_to&&typeof(r==null?void 0:r.ship_to)=="string"&&(r.ship_to=new Array(r.ship_to));const n=Object.assign({page:1,page_size:50,search_date:[],order_type:[],ship_to:[]},r),{data:u,runAsync:y}=V(ce,{defaultParams:[n],debounceWait:300,manual:!0});return I.useEffect(()=>{y(n)},[f]),e.jsxs(Z,{code:"orders",title:"My Orders",children:[e.jsx(A,{sx:d=>({background:d.palette.primary.light,color:d.palette.common.white}),children:e.jsxs(a,{display:"flex",justifyContent:"space-evenly",alignItems:"center",height:"60px",children:[e.jsxs(a,{textAlign:"center",children:[e.jsx(D,{children:"Orders"}),e.jsx(_,{children:"12"})]}),e.jsxs(a,{textAlign:"center",children:[e.jsx(D,{children:"Ordered items"}),e.jsx(_,{children:"471"})]}),e.jsxs(a,{textAlign:"center",children:[e.jsx(D,{children:"Total amount"}),e.jsx(_,{children:L(12723.39)})]})]})}),e.jsxs(A,{sx:{width:"80%",margin:"20px auto",height:"70px",display:"flex",justifyContent:"space-evenly",alignItems:"center"},children:[e.jsxs(x,{color:"primary",fontSize:"1.2rem",fontWeight:500,children:["You can also ",e.jsx("b",{children:"PLACE ORDER"})," by"]}),e.jsxs(m,{color:"success",sx:{width:"180px"},onClick:()=>p("/account/quickOrder"),children:[e.jsx(x,{fontSize:"1.2rem",fontWeight:700,marginRight:1,children:"Quick Order"}),e.jsx("img",{src:fe})]}),e.jsxs(m,{color:"success",sx:{width:"180px"},onClick:()=>g(!0),children:[e.jsx(x,{fontSize:"1.2rem",fontWeight:700,marginRight:1,children:"Volume Order"}),e.jsx("img",{src:ye})]})]}),e.jsxs(A,{children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 20px",children:[e.jsx(a,{display:"flex",columnGap:"10px",children:["","Pending","Confirmed","Processing","Packed","Completed","Cancelled"].map(d=>{const j=d.toLowerCase();return e.jsx(F,{variant:"text",badge:d,sx:{fontSize:"1.2rem",fontWeight:500},onClick:()=>{p(`/account/orders${d?`?type=${j}`:""}`)},className:((n==null?void 0:n.type)??"")==j?"active":"",children:d||"All orders"},d)})}),e.jsxs(a,{display:"flex",columnGap:"3px",fontSize:"1.2rem",children:[e.jsx(x,{color:"primary",fontWeight:700,children:(u==null?void 0:u.total)??0}),e.jsx(x,{fontWeight:500,color:"text.secondary",children:"results"})]})]}),e.jsx(a,{padding:"10px 20px",children:e.jsx(F,{variant:"text",onClick:()=>p("/account/orders?type=pdf"),className:(n==null?void 0:n.type)=="pdf"?"active":"",children:e.jsx(x,{color:"secondary",fontSize:"1.2rem",fontWeight:500,padding:"6px",sx:{textDecoration:"underline"},children:"PI PDF download"})})}),e.jsx(Ce,{type:n==null?void 0:n.type,rowData:u,onChange:d=>{p(z.stringifyUrl({url:"/account/orders",query:d},{arrayFormat:"comma"}))},defaultParams:n}),e.jsx(Oe,{open:c,onClose:()=>g(!1)})]})]})}export{Le as default};
